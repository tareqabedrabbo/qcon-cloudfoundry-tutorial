# A Simple Spring app with MySql.

In this lab, we will deploy a very simple Spring application to CloudFoundry and bind it to one MySql instance.

##Â Get the app

The app is available in the [github repo under lab-4](https://github.com/tareqabedrabbo/qcon-cloudfoundry-tutorial/tree/master/). If you haven't done so already, clone the repository using:

	$ git clone git@github.com:tareqabedrabbo/qcon-cloudfoundry-tutorial.git

Alternatively, you can download a [zip archive](https://github.com/tareqabedrabbo/qcon-cloudfoundry-tutorial/zipball/master) from github.

The application itself is a simple stateless Spring MVC app that exposes one controller and contains one data repository. It is worth noting that the application doesn't have any dependency on Cloud Foundry. Go to src/main/webapp/WEB-INF/spring/root-context.xml to see that the application contains a bean definition for a local MySql data source:

	<bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource"
		destroy-method="close">
		<property name="driverClassName" value="com.mysql.jdbc.Driver" />
		<property name="url" value="jdbc:mysql://127.0.0.1:3306/test" />
		<property name="username" value="spring" />
		<property name="password" value="spring" />
	</bean>

	<jdbc:initialize-database data-source="dataSource">
		<jdbc:script location="classpath:db-schema.sql"/>
	</jdbc:initialize-database>

## Build and deploy the app

Build the app using Maven:

	$ mvn package

Now we can push the application to Cloud Foundry. But since the application needs a database to wrok properly, we need to create one and bind it to our application.
The good news is that Cloud Foundry can do the binding for us automatically; we only need to create a MySql service when we push the app:

	$ vmc push hello-mysql --path target

When vmc asks 'Create services to bind to 'hello-mysql'?' choose 'y' then choose mysql as the type of service and accept the default name by hitting Enter. For the other questions the default answer is fine (just hit Enter):

	Create services to bind to 'hello-mysql'? [yN]: y
	1: mongodb
	2: mysql
	3: postgresql
	4: rabbitmq
	5: redis
	What kind of service?: 2
	Specify the name of the service [mysql-dccd]: 

Once you get the following confirmation, the deployment should be ok:

	Starting Application 'hello-mysql': OK 

## Check the logs

Cloud Foundry allows you to inspect the logs generated by application using the following command:

	$ vmc logs hello-mysql

You can notice that the output is simple tomcat logs and that the application has started normally. To confirm that go to http://hello-mysql.<username>.cloudfoundry.me. You should have an output similar to the following:

	Hello Spring MySQL!

	Database Info:

	DataSource: jdbc:mysql://127.0.0.1:3306/df147da3f7edd41c6b86a76fe731cbbab
	Current States:

	State [id=1, stateCode=MA, name=Massachusetts]
	State [id=2, stateCode=NH, name=New Hampshire]
	State [id=3, stateCode=ME, name=Maine]
	State [id=4, stateCode=VT, name=Vermont]

What's that weird datasource reference? What happened is that Cloud Foundry replaced your bean definition pointing to a local MySql instance with one pointing to the service that you created in the previous step. This is the simplest way to deploy an exisiting application to Cloud Foundry if you only need to connect to a single data source, which is sufficient for many web applications.

In the next section we will see how services work and how to bind your applications to more than one service.